"use strict";var Et=Object.create;var $=Object.defineProperty;var _t=Object.getOwnPropertyDescriptor;var kt=Object.getOwnPropertyNames;var Dt=Object.getPrototypeOf,St=Object.prototype.hasOwnProperty;var E=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Pt=(r,e)=>{for(var t in e)$(r,t,{get:e[t],enumerable:!0})},ce=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of kt(e))!St.call(r,n)&&n!==t&&$(r,n,{get:()=>e[n],enumerable:!(s=_t(e,n))||s.enumerable});return r};var C=(r,e,t)=>(t=r!=null?Et(Dt(r)):{},ce(e||!r||!r.__esModule?$(t,"default",{value:r,enumerable:!0}):t,r)),xt=r=>ce($({},"__esModule",{value:!0}),r);var z=E(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.Event=L.Response=L.Message=void 0;var N=class{constructor(e){this.seq=0,this.type=e}};L.Message=N;var le=class extends N{constructor(e,t){super("response");this.request_seq=e.seq,this.command=e.command,t?(this.success=!1,this.message=t):this.success=!0}};L.Response=le;var de=class extends N{constructor(e,t){super("event");this.event=e,t&&(this.body=t)}};L.Event=de});var he=E(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.ProtocolServer=void 0;var wt=require("events"),U=z(),pe=class{get event(){return this._event||(this._event=(e,t)=>{this._listener=e,this._this=t;let s;return s={dispose:()=>{this._listener=void 0,this._this=void 0}},s}),this._event}fire(e){if(this._listener)try{this._listener.call(this._this,e)}catch{}}hasListener(){return!!this._listener}dispose(){this._listener=void 0,this._this=void 0}},q=class extends wt.EventEmitter{constructor(){super();this._sendMessage=new pe,this._pendingRequests=new Map,this.onDidSendMessage=this._sendMessage.event}dispose(){}handleMessage(e){if(e.type==="request")this.dispatchRequest(e);else if(e.type==="response"){let t=e,s=this._pendingRequests.get(t.request_seq);s&&(this._pendingRequests.delete(t.request_seq),s(t))}}_isRunningInline(){return this._sendMessage&&this._sendMessage.hasListener()}start(e,t){this._sequence=1,this._writableStream=t,this._rawData=Buffer.alloc(0),e.on("data",s=>this._handleData(s)),e.on("close",()=>{this._emitEvent(new U.Event("close"))}),e.on("error",s=>{this._emitEvent(new U.Event("error","inStream error: "+(s&&s.message)))}),t.on("error",s=>{this._emitEvent(new U.Event("error","outStream error: "+(s&&s.message)))}),e.resume()}stop(){this._writableStream&&this._writableStream.end()}sendEvent(e){this._send("event",e)}sendResponse(e){e.seq>0?console.error(`attempt to send more than one response for command ${e.command}`):this._send("response",e)}sendRequest(e,t,s,n){let i={command:e};if(t&&Object.keys(t).length>0&&(i.arguments=t),this._send("request",i),n){this._pendingRequests.set(i.seq,n);let o=setTimeout(()=>{clearTimeout(o);let a=this._pendingRequests.get(i.seq);a&&(this._pendingRequests.delete(i.seq),a(new U.Response(i,"timeout")))},s)}}dispatchRequest(e){}_emitEvent(e){this.emit(e.event,e)}_send(e,t){if(t.type=e,t.seq=this._sequence++,this._writableStream){let s=JSON.stringify(t);this._writableStream.write(`Content-Length: ${Buffer.byteLength(s,"utf8")}\r
\r
${s}`,"utf8")}this._sendMessage.fire(t)}_handleData(e){for(this._rawData=Buffer.concat([this._rawData,e]);;){if(this._contentLength>=0){if(this._rawData.length>=this._contentLength){let t=this._rawData.toString("utf8",0,this._contentLength);if(this._rawData=this._rawData.slice(this._contentLength),this._contentLength=-1,t.length>0)try{let s=JSON.parse(t);this.handleMessage(s)}catch(s){this._emitEvent(new U.Event("error","Error handling data: "+(s&&s.message)))}continue}}else{let t=this._rawData.indexOf(q.TWO_CRLF);if(t!==-1){let n=this._rawData.toString("utf8",0,t).split(`\r
`);for(let i=0;i<n.length;i++){let o=n[i].split(/: +/);o[0]=="Content-Length"&&(this._contentLength=+o[1])}this._rawData=this._rawData.slice(t+q.TWO_CRLF.length);continue}}break}}};H.ProtocolServer=q;q.TWO_CRLF=`\r
\r
`});var ge=E(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.runDebugAdapter=void 0;var Lt=require("net");function At(r){let e=0;if(process.argv.slice(2).forEach(function(s,n,i){let o=/^--server=(\d{4,5})$/.exec(s);o&&(e=parseInt(o[1],10))}),e>0)console.error(`waiting for debug protocol on port ${e}`),Lt.createServer(s=>{console.error(">> accepted connection from client"),s.on("end",()=>{console.error(`>> client connection closed
`)});let n=new r(!1,!0);n.setRunAsServer(!0),n.start(s,s)}).listen(e);else{let s=new r(!1);process.on("SIGTERM",()=>{s.shutdown()}),s.start(process.stdin,process.stdout)}}W.runDebugAdapter=At});var G=E(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});l.DebugSession=l.ErrorDestination=l.MemoryEvent=l.InvalidatedEvent=l.ProgressEndEvent=l.ProgressUpdateEvent=l.ProgressStartEvent=l.CapabilitiesEvent=l.LoadedSourceEvent=l.ModuleEvent=l.BreakpointEvent=l.ThreadEvent=l.OutputEvent=l.ExitedEvent=l.TerminatedEvent=l.InitializedEvent=l.ContinuedEvent=l.StoppedEvent=l.CompletionItem=l.Module=l.Breakpoint=l.Variable=l.Thread=l.StackFrame=l.Scope=l.Source=void 0;var Ct=he(),b=z(),It=ge(),me=require("url"),fe=class{constructor(e,t,s=0,n,i){this.name=e,this.path=t,this.sourceReference=s,n&&(this.origin=n),i&&(this.adapterData=i)}};l.Source=fe;var be=class{constructor(e,t,s=!1){this.name=e,this.variablesReference=t,this.expensive=s}};l.Scope=be;var ve=class{constructor(e,t,s,n=0,i=0){this.id=e,this.source=s,this.line=n,this.column=i,this.name=t}};l.StackFrame=ve;var Re=class{constructor(e,t){this.id=e,t?this.name=t:this.name="Thread #"+e}};l.Thread=Re;var ye=class{constructor(e,t,s=0,n,i){this.name=e,this.value=t,this.variablesReference=s,typeof i=="number"&&(this.namedVariables=i),typeof n=="number"&&(this.indexedVariables=n)}};l.Variable=ye;var Ee=class{constructor(e,t,s,n){this.verified=e;let i=this;typeof t=="number"&&(i.line=t),typeof s=="number"&&(i.column=s),n&&(i.source=n)}setId(e){this.id=e}};l.Breakpoint=Ee;var _e=class{constructor(e,t){this.id=e,this.name=t}};l.Module=_e;var ke=class{constructor(e,t,s=0){this.label=e,this.start=t,this.length=s}};l.CompletionItem=ke;var De=class extends b.Event{constructor(e,t,s){super("stopped");this.body={reason:e},typeof t=="number"&&(this.body.threadId=t),typeof s=="string"&&(this.body.text=s)}};l.StoppedEvent=De;var Se=class extends b.Event{constructor(e,t){super("continued");this.body={threadId:e},typeof t=="boolean"&&(this.body.allThreadsContinued=t)}};l.ContinuedEvent=Se;var Pe=class extends b.Event{constructor(){super("initialized")}};l.InitializedEvent=Pe;var xe=class extends b.Event{constructor(e){super("terminated");if(typeof e=="boolean"||e){let t=this;t.body={restart:e}}}};l.TerminatedEvent=xe;var we=class extends b.Event{constructor(e){super("exited");this.body={exitCode:e}}};l.ExitedEvent=we;var Le=class extends b.Event{constructor(e,t="console",s){super("output");this.body={category:t,output:e},s!==void 0&&(this.body.data=s)}};l.OutputEvent=Le;var Ae=class extends b.Event{constructor(e,t){super("thread");this.body={reason:e,threadId:t}}};l.ThreadEvent=Ae;var Ce=class extends b.Event{constructor(e,t){super("breakpoint");this.body={reason:e,breakpoint:t}}};l.BreakpointEvent=Ce;var Ie=class extends b.Event{constructor(e,t){super("module");this.body={reason:e,module:t}}};l.ModuleEvent=Ie;var Te=class extends b.Event{constructor(e,t){super("loadedSource");this.body={reason:e,source:t}}};l.LoadedSourceEvent=Te;var Fe=class extends b.Event{constructor(e){super("capabilities");this.body={capabilities:e}}};l.CapabilitiesEvent=Fe;var qe=class extends b.Event{constructor(e,t,s){super("progressStart");this.body={progressId:e,title:t},typeof s=="string"&&(this.body.message=s)}};l.ProgressStartEvent=qe;var Be=class extends b.Event{constructor(e,t){super("progressUpdate");this.body={progressId:e},typeof t=="string"&&(this.body.message=t)}};l.ProgressUpdateEvent=Be;var Oe=class extends b.Event{constructor(e,t){super("progressEnd");this.body={progressId:e},typeof t=="string"&&(this.body.message=t)}};l.ProgressEndEvent=Oe;var Me=class extends b.Event{constructor(e,t,s){super("invalidated");this.body={},e&&(this.body.areas=e),t&&(this.body.threadId=t),s&&(this.body.stackFrameId=s)}};l.InvalidatedEvent=Me;var Ve=class extends b.Event{constructor(e,t,s){super("memory");this.body={memoryReference:e,offset:t,count:s}}};l.MemoryEvent=Ve;var I;(function(r){r[r.User=1]="User",r[r.Telemetry=2]="Telemetry"})(I=l.ErrorDestination||(l.ErrorDestination={}));var S=class extends Ct.ProtocolServer{constructor(e,t){super();let s=typeof e=="boolean"?e:!1;this._debuggerLinesStartAt1=s,this._debuggerColumnsStartAt1=s,this._debuggerPathsAreURIs=!1,this._clientLinesStartAt1=!0,this._clientColumnsStartAt1=!0,this._clientPathsAreURIs=!1,this._isServer=typeof t=="boolean"?t:!1,this.on("close",()=>{this.shutdown()}),this.on("error",n=>{this.shutdown()})}setDebuggerPathFormat(e){this._debuggerPathsAreURIs=e!=="path"}setDebuggerLinesStartAt1(e){this._debuggerLinesStartAt1=e}setDebuggerColumnsStartAt1(e){this._debuggerColumnsStartAt1=e}setRunAsServer(e){this._isServer=e}static run(e){(0,It.runDebugAdapter)(e)}shutdown(){this._isServer||this._isRunningInline()||setTimeout(()=>{process.exit(0)},100)}sendErrorResponse(e,t,s,n,i=I.User){let o;typeof t=="number"?(o={id:t,format:s},n&&(o.variables=n),i&I.User&&(o.showUser=!0),i&I.Telemetry&&(o.sendTelemetry=!0)):o=t,e.success=!1,e.message=S.formatPII(o.format,!0,o.variables),e.body||(e.body={}),e.body.error=o,this.sendResponse(e)}runInTerminalRequest(e,t,s){this.sendRequest("runInTerminal",e,t,s)}dispatchRequest(e){let t=new b.Response(e);try{if(e.command==="initialize"){var s=e.arguments;if(typeof s.linesStartAt1=="boolean"&&(this._clientLinesStartAt1=s.linesStartAt1),typeof s.columnsStartAt1=="boolean"&&(this._clientColumnsStartAt1=s.columnsStartAt1),s.pathFormat!=="path")this.sendErrorResponse(t,2018,"debug adapter only supports native paths",null,I.Telemetry);else{let n=t;n.body={},this.initializeRequest(n,s)}}else e.command==="launch"?this.launchRequest(t,e.arguments,e):e.command==="attach"?this.attachRequest(t,e.arguments,e):e.command==="disconnect"?this.disconnectRequest(t,e.arguments,e):e.command==="terminate"?this.terminateRequest(t,e.arguments,e):e.command==="restart"?this.restartRequest(t,e.arguments,e):e.command==="setBreakpoints"?this.setBreakPointsRequest(t,e.arguments,e):e.command==="setFunctionBreakpoints"?this.setFunctionBreakPointsRequest(t,e.arguments,e):e.command==="setExceptionBreakpoints"?this.setExceptionBreakPointsRequest(t,e.arguments,e):e.command==="configurationDone"?this.configurationDoneRequest(t,e.arguments,e):e.command==="continue"?this.continueRequest(t,e.arguments,e):e.command==="next"?this.nextRequest(t,e.arguments,e):e.command==="stepIn"?this.stepInRequest(t,e.arguments,e):e.command==="stepOut"?this.stepOutRequest(t,e.arguments,e):e.command==="stepBack"?this.stepBackRequest(t,e.arguments,e):e.command==="reverseContinue"?this.reverseContinueRequest(t,e.arguments,e):e.command==="restartFrame"?this.restartFrameRequest(t,e.arguments,e):e.command==="goto"?this.gotoRequest(t,e.arguments,e):e.command==="pause"?this.pauseRequest(t,e.arguments,e):e.command==="stackTrace"?this.stackTraceRequest(t,e.arguments,e):e.command==="scopes"?this.scopesRequest(t,e.arguments,e):e.command==="variables"?this.variablesRequest(t,e.arguments,e):e.command==="setVariable"?this.setVariableRequest(t,e.arguments,e):e.command==="setExpression"?this.setExpressionRequest(t,e.arguments,e):e.command==="source"?this.sourceRequest(t,e.arguments,e):e.command==="threads"?this.threadsRequest(t,e):e.command==="terminateThreads"?this.terminateThreadsRequest(t,e.arguments,e):e.command==="evaluate"?this.evaluateRequest(t,e.arguments,e):e.command==="stepInTargets"?this.stepInTargetsRequest(t,e.arguments,e):e.command==="gotoTargets"?this.gotoTargetsRequest(t,e.arguments,e):e.command==="completions"?this.completionsRequest(t,e.arguments,e):e.command==="exceptionInfo"?this.exceptionInfoRequest(t,e.arguments,e):e.command==="loadedSources"?this.loadedSourcesRequest(t,e.arguments,e):e.command==="dataBreakpointInfo"?this.dataBreakpointInfoRequest(t,e.arguments,e):e.command==="setDataBreakpoints"?this.setDataBreakpointsRequest(t,e.arguments,e):e.command==="readMemory"?this.readMemoryRequest(t,e.arguments,e):e.command==="writeMemory"?this.writeMemoryRequest(t,e.arguments,e):e.command==="disassemble"?this.disassembleRequest(t,e.arguments,e):e.command==="cancel"?this.cancelRequest(t,e.arguments,e):e.command==="breakpointLocations"?this.breakpointLocationsRequest(t,e.arguments,e):e.command==="setInstructionBreakpoints"?this.setInstructionBreakpointsRequest(t,e.arguments,e):this.customRequest(e.command,t,e.arguments,e)}catch(n){this.sendErrorResponse(t,1104,"{_stack}",{_exception:n.message,_stack:n.stack},I.Telemetry)}}initializeRequest(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,e.body.supportsRestartRequest=!1,e.body.supportsExceptionOptions=!1,e.body.supportsValueFormattingOptions=!1,e.body.supportsExceptionInfoRequest=!1,e.body.supportTerminateDebuggee=!1,e.body.supportsDelayedStackTraceLoading=!1,e.body.supportsLoadedSourcesRequest=!1,e.body.supportsLogPoints=!1,e.body.supportsTerminateThreadsRequest=!1,e.body.supportsSetExpression=!1,e.body.supportsTerminateRequest=!1,e.body.supportsDataBreakpoints=!1,e.body.supportsReadMemoryRequest=!1,e.body.supportsDisassembleRequest=!1,e.body.supportsCancelRequest=!1,e.body.supportsBreakpointLocationsRequest=!1,e.body.supportsClipboardContext=!1,e.body.supportsSteppingGranularity=!1,e.body.supportsInstructionBreakpoints=!1,e.body.supportsExceptionFilterOptions=!1,this.sendResponse(e)}disconnectRequest(e,t,s){this.sendResponse(e),this.shutdown()}launchRequest(e,t,s){this.sendResponse(e)}attachRequest(e,t,s){this.sendResponse(e)}terminateRequest(e,t,s){this.sendResponse(e)}restartRequest(e,t,s){this.sendResponse(e)}setBreakPointsRequest(e,t,s){this.sendResponse(e)}setFunctionBreakPointsRequest(e,t,s){this.sendResponse(e)}setExceptionBreakPointsRequest(e,t,s){this.sendResponse(e)}configurationDoneRequest(e,t,s){this.sendResponse(e)}continueRequest(e,t,s){this.sendResponse(e)}nextRequest(e,t,s){this.sendResponse(e)}stepInRequest(e,t,s){this.sendResponse(e)}stepOutRequest(e,t,s){this.sendResponse(e)}stepBackRequest(e,t,s){this.sendResponse(e)}reverseContinueRequest(e,t,s){this.sendResponse(e)}restartFrameRequest(e,t,s){this.sendResponse(e)}gotoRequest(e,t,s){this.sendResponse(e)}pauseRequest(e,t,s){this.sendResponse(e)}sourceRequest(e,t,s){this.sendResponse(e)}threadsRequest(e,t){this.sendResponse(e)}terminateThreadsRequest(e,t,s){this.sendResponse(e)}stackTraceRequest(e,t,s){this.sendResponse(e)}scopesRequest(e,t,s){this.sendResponse(e)}variablesRequest(e,t,s){this.sendResponse(e)}setVariableRequest(e,t,s){this.sendResponse(e)}setExpressionRequest(e,t,s){this.sendResponse(e)}evaluateRequest(e,t,s){this.sendResponse(e)}stepInTargetsRequest(e,t,s){this.sendResponse(e)}gotoTargetsRequest(e,t,s){this.sendResponse(e)}completionsRequest(e,t,s){this.sendResponse(e)}exceptionInfoRequest(e,t,s){this.sendResponse(e)}loadedSourcesRequest(e,t,s){this.sendResponse(e)}dataBreakpointInfoRequest(e,t,s){this.sendResponse(e)}setDataBreakpointsRequest(e,t,s){this.sendResponse(e)}readMemoryRequest(e,t,s){this.sendResponse(e)}writeMemoryRequest(e,t,s){this.sendResponse(e)}disassembleRequest(e,t,s){this.sendResponse(e)}cancelRequest(e,t,s){this.sendResponse(e)}breakpointLocationsRequest(e,t,s){this.sendResponse(e)}setInstructionBreakpointsRequest(e,t,s){this.sendResponse(e)}customRequest(e,t,s,n){this.sendErrorResponse(t,1014,"unrecognized request",null,I.Telemetry)}convertClientLineToDebugger(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e+1:this._clientLinesStartAt1?e-1:e}convertDebuggerLineToClient(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e-1:this._clientLinesStartAt1?e+1:e}convertClientColumnToDebugger(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e+1:this._clientColumnsStartAt1?e-1:e}convertDebuggerColumnToClient(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e-1:this._clientColumnsStartAt1?e+1:e}convertClientPathToDebugger(e){return this._clientPathsAreURIs!==this._debuggerPathsAreURIs?this._clientPathsAreURIs?S.uri2path(e):S.path2uri(e):e}convertDebuggerPathToClient(e){return this._debuggerPathsAreURIs!==this._clientPathsAreURIs?this._debuggerPathsAreURIs?S.uri2path(e):S.path2uri(e):e}static path2uri(e){process.platform==="win32"&&(/^[A-Z]:/.test(e)&&(e=e[0].toLowerCase()+e.substr(1)),e=e.replace(/\\/g,"/")),e=encodeURI(e);let t=new me.URL("file:");return t.pathname=e,t.toString()}static uri2path(e){let t=new me.URL(e),s=decodeURIComponent(t.pathname);return process.platform==="win32"&&(/^\/[a-zA-Z]:/.test(s)&&(s=s[1].toLowerCase()+s.substr(2)),s=s.replace(/\//g,"\\")),s}static formatPII(e,t,s){return e.replace(S._formatPIIRegexp,function(n,i){return t&&i.length>0&&i[0]!=="_"?n:s[i]&&s.hasOwnProperty(i)?s[i]:n})}};l.DebugSession=S;S._formatPIIRegexp=/{([^}]+)}/g});var ze=E(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.InternalLogger=void 0;var Ue=require("fs"),je=require("path"),R=Z(),Ne=class{constructor(e,t){this.beforeExitCallback=()=>this.dispose(),this._logCallback=e,this._logToConsole=t,this._minLogLevel=R.LogLevel.Warn,this.disposeCallback=(s,n)=>{this.dispose(),n=n||2,n+=128,process.exit(n)}}async setup(e){if(this._minLogLevel=e.consoleMinLogLevel,this._prependTimestamp=e.prependTimestamp,e.logFilePath)if(!je.isAbsolute(e.logFilePath))this.log(`logFilePath must be an absolute path: ${e.logFilePath}`,R.LogLevel.Error);else{let t=s=>this.sendLog(`Error creating log file at path: ${e.logFilePath}. Error: ${s.toString()}
`,R.LogLevel.Error);try{await Ue.promises.mkdir(je.dirname(e.logFilePath),{recursive:!0}),this.log(`Verbose logs are written to:
`,R.LogLevel.Warn),this.log(e.logFilePath+`
`,R.LogLevel.Warn),this._logFileStream=Ue.createWriteStream(e.logFilePath),this.logDateTime(),this.setupShutdownListeners(),this._logFileStream.on("error",s=>{t(s)})}catch(s){t(s)}}}logDateTime(){let e=new Date,s=e.getUTCFullYear()+`-${e.getUTCMonth()+1}-`+e.getUTCDate()+", "+$e();this.log(s+`
`,R.LogLevel.Verbose,!1)}setupShutdownListeners(){process.on("beforeExit",this.beforeExitCallback),process.on("SIGTERM",this.disposeCallback),process.on("SIGINT",this.disposeCallback)}removeShutdownListeners(){process.removeListener("beforeExit",this.beforeExitCallback),process.removeListener("SIGTERM",this.disposeCallback),process.removeListener("SIGINT",this.disposeCallback)}dispose(){return new Promise(e=>{this.removeShutdownListeners(),this._logFileStream?(this._logFileStream.end(e),this._logFileStream=null):e()})}log(e,t,s=!0){if(this._minLogLevel!==R.LogLevel.Stop){if(t>=this._minLogLevel&&this.sendLog(e,t),this._logToConsole){let n=t===R.LogLevel.Error?console.error:t===R.LogLevel.Warn?console.warn:null;n&&n((0,R.trimLastNewline)(e))}t===R.LogLevel.Error&&(e=`[${R.LogLevel[t]}] ${e}`),this._prependTimestamp&&s&&(e="["+$e()+"] "+e),this._logFileStream&&this._logFileStream.write(e)}}sendLog(e,t){if(e.length>1500){let s=!!e.match(/(\n|\r\n)$/);e=e.substr(0,1500)+"[...]",s&&(e=e+`
`)}if(this._logCallback){let s=new R.LogOutputEvent(e,t);this._logCallback(s)}}};Q.InternalLogger=Ne;function $e(){let r=new Date,e=J(2,String(r.getUTCHours())),t=J(2,String(r.getUTCMinutes())),s=J(2,String(r.getUTCSeconds())),n=J(3,String(r.getUTCMilliseconds()));return e+":"+t+":"+s+"."+n+" UTC"}function J(r,e){return e.length>=r?e:String("0".repeat(r)+e).slice(-r)}});var Z=E(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.trimLastNewline=y.LogOutputEvent=y.logger=y.Logger=y.LogLevel=void 0;var Tt=ze(),Ft=G(),A;(function(r){r[r.Verbose=0]="Verbose",r[r.Log=1]="Log",r[r.Warn=2]="Warn",r[r.Error=3]="Error",r[r.Stop=4]="Stop"})(A=y.LogLevel||(y.LogLevel={}));var re=class{constructor(){this._pendingLogQ=[]}log(e,t=A.Log){e=e+`
`,this._write(e,t)}verbose(e){this.log(e,A.Verbose)}warn(e){this.log(e,A.Warn)}error(e){this.log(e,A.Error)}dispose(){if(this._currentLogger){let e=this._currentLogger.dispose();return this._currentLogger=null,e}else return Promise.resolve()}_write(e,t=A.Log){e=e+"",this._pendingLogQ?this._pendingLogQ.push({msg:e,level:t}):this._currentLogger&&this._currentLogger.log(e,t)}setup(e,t,s=!0){let n=typeof t=="string"?t:t&&this._logFilePathFromInit;if(this._currentLogger){let i={consoleMinLogLevel:e,logFilePath:n,prependTimestamp:s};this._currentLogger.setup(i).then(()=>{if(this._pendingLogQ){let o=this._pendingLogQ;this._pendingLogQ=null,o.forEach(a=>this._write(a.msg,a.level))}})}}init(e,t,s){this._pendingLogQ=this._pendingLogQ||[],this._currentLogger=new Tt.InternalLogger(e,s),this._logFilePathFromInit=t}};y.Logger=re;y.logger=new re;var He=class extends Ft.OutputEvent{constructor(e,t){let s=t===A.Error?"stderr":t===A.Warn?"console":"stdout";super(e,s)}};y.LogOutputEvent=He;function qt(r){return r.replace(/(\n|\r\n)$/,"")}y.trimLastNewline=qt});var Qe=E(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.LoggingDebugSession=void 0;var Ge=Z(),B=Ge.logger,We=G(),Je=class extends We.DebugSession{constructor(e,t,s){super(t,s);this.obsolete_logFilePath=e,this.on("error",n=>{B.error(n.body)})}start(e,t){super.start(e,t),B.init(s=>this.sendEvent(s),this.obsolete_logFilePath,this._isServer)}sendEvent(e){if(!(e instanceof Ge.LogOutputEvent)){let t=e;e instanceof We.OutputEvent&&e.body&&e.body.data&&e.body.data.doNotLogOutput&&(delete e.body.data.doNotLogOutput,t={...e},t.body={...e.body,output:"<output not logged>"}),B.verbose(`To client: ${JSON.stringify(t)}`)}super.sendEvent(e)}sendRequest(e,t,s,n){B.verbose(`To client: ${JSON.stringify(e)}(${JSON.stringify(t)}), timeout: ${s}`),super.sendRequest(e,t,s,n)}sendResponse(e){B.verbose(`To client: ${JSON.stringify(e)}`),super.sendResponse(e)}dispatchRequest(e){B.verbose(`From client: ${e.command}(${JSON.stringify(e.arguments)})`),super.dispatchRequest(e)}};X.LoggingDebugSession=Je});var Xe=E(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.Handles=void 0;var Ze=class{constructor(e){this.START_HANDLE=1e3,this._handleMap=new Map,this._nextHandle=typeof e=="number"?e:this.START_HANDLE}reset(){this._nextHandle=this.START_HANDLE,this._handleMap=new Map}create(e){var t=this._nextHandle++;return this._handleMap.set(t,e),t}get(e,t){return this._handleMap.get(e)||t}};K.Handles=Ze});var et=E(c=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.Handles=c.Response=c.Event=c.ErrorDestination=c.CompletionItem=c.Module=c.Source=c.Breakpoint=c.Variable=c.Scope=c.StackFrame=c.Thread=c.MemoryEvent=c.InvalidatedEvent=c.ProgressEndEvent=c.ProgressUpdateEvent=c.ProgressStartEvent=c.CapabilitiesEvent=c.LoadedSourceEvent=c.ModuleEvent=c.BreakpointEvent=c.ThreadEvent=c.OutputEvent=c.ContinuedEvent=c.StoppedEvent=c.ExitedEvent=c.TerminatedEvent=c.InitializedEvent=c.logger=c.Logger=c.LoggingDebugSession=c.DebugSession=void 0;var f=G();Object.defineProperty(c,"DebugSession",{enumerable:!0,get:function(){return f.DebugSession}});Object.defineProperty(c,"InitializedEvent",{enumerable:!0,get:function(){return f.InitializedEvent}});Object.defineProperty(c,"TerminatedEvent",{enumerable:!0,get:function(){return f.TerminatedEvent}});Object.defineProperty(c,"ExitedEvent",{enumerable:!0,get:function(){return f.ExitedEvent}});Object.defineProperty(c,"StoppedEvent",{enumerable:!0,get:function(){return f.StoppedEvent}});Object.defineProperty(c,"ContinuedEvent",{enumerable:!0,get:function(){return f.ContinuedEvent}});Object.defineProperty(c,"OutputEvent",{enumerable:!0,get:function(){return f.OutputEvent}});Object.defineProperty(c,"ThreadEvent",{enumerable:!0,get:function(){return f.ThreadEvent}});Object.defineProperty(c,"BreakpointEvent",{enumerable:!0,get:function(){return f.BreakpointEvent}});Object.defineProperty(c,"ModuleEvent",{enumerable:!0,get:function(){return f.ModuleEvent}});Object.defineProperty(c,"LoadedSourceEvent",{enumerable:!0,get:function(){return f.LoadedSourceEvent}});Object.defineProperty(c,"CapabilitiesEvent",{enumerable:!0,get:function(){return f.CapabilitiesEvent}});Object.defineProperty(c,"ProgressStartEvent",{enumerable:!0,get:function(){return f.ProgressStartEvent}});Object.defineProperty(c,"ProgressUpdateEvent",{enumerable:!0,get:function(){return f.ProgressUpdateEvent}});Object.defineProperty(c,"ProgressEndEvent",{enumerable:!0,get:function(){return f.ProgressEndEvent}});Object.defineProperty(c,"InvalidatedEvent",{enumerable:!0,get:function(){return f.InvalidatedEvent}});Object.defineProperty(c,"MemoryEvent",{enumerable:!0,get:function(){return f.MemoryEvent}});Object.defineProperty(c,"Thread",{enumerable:!0,get:function(){return f.Thread}});Object.defineProperty(c,"StackFrame",{enumerable:!0,get:function(){return f.StackFrame}});Object.defineProperty(c,"Scope",{enumerable:!0,get:function(){return f.Scope}});Object.defineProperty(c,"Variable",{enumerable:!0,get:function(){return f.Variable}});Object.defineProperty(c,"Breakpoint",{enumerable:!0,get:function(){return f.Breakpoint}});Object.defineProperty(c,"Source",{enumerable:!0,get:function(){return f.Source}});Object.defineProperty(c,"Module",{enumerable:!0,get:function(){return f.Module}});Object.defineProperty(c,"CompletionItem",{enumerable:!0,get:function(){return f.CompletionItem}});Object.defineProperty(c,"ErrorDestination",{enumerable:!0,get:function(){return f.ErrorDestination}});var Bt=Qe();Object.defineProperty(c,"LoggingDebugSession",{enumerable:!0,get:function(){return Bt.LoggingDebugSession}});var Ke=Z();c.Logger=Ke;var Ye=z();Object.defineProperty(c,"Event",{enumerable:!0,get:function(){return Ye.Event}});Object.defineProperty(c,"Response",{enumerable:!0,get:function(){return Ye.Response}});var Ot=Xe();Object.defineProperty(c,"Handles",{enumerable:!0,get:function(){return Ot.Handles}});var Mt=Ke.logger;c.logger=Mt});var nt=E((as,st)=>{"use strict";function P(r){if(typeof r!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(r))}function tt(r,e){for(var t="",s=0,n=-1,i=0,o,a=0;a<=r.length;++a){if(a<r.length)o=r.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||i===1))if(n!==a-1&&i===2){if(t.length<2||s!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var u=t.lastIndexOf("/");if(u!==t.length-1){u===-1?(t="",s=0):(t=t.slice(0,u),s=t.length-1-t.lastIndexOf("/")),n=a,i=0;continue}}else if(t.length===2||t.length===1){t="",s=0,n=a,i=0;continue}}e&&(t.length>0?t+="/..":t="..",s=2)}else t.length>0?t+="/"+r.slice(n+1,a):t=r.slice(n+1,a),s=a-n-1;n=a,i=0}else o===46&&i!==-1?++i:i=-1}return t}function Vt(r,e){var t=e.dir||e.root,s=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+s:t+r+s:s}var O={resolve:function(){for(var e="",t=!1,s,n=arguments.length-1;n>=-1&&!t;n--){var i;n>=0?i=arguments[n]:(s===void 0&&(s=process.cwd()),i=s),P(i),i.length!==0&&(e=i+"/"+e,t=i.charCodeAt(0)===47)}return e=tt(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(P(e),e.length===0)return".";var t=e.charCodeAt(0)===47,s=e.charCodeAt(e.length-1)===47;return e=tt(e,!t),e.length===0&&!t&&(e="."),e.length>0&&s&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return P(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var s=arguments[t];P(s),s.length>0&&(e===void 0?e=s:e+="/"+s)}return e===void 0?".":O.normalize(e)},relative:function(e,t){if(P(e),P(t),e===t||(e=O.resolve(e),t=O.resolve(t),e===t))return"";for(var s=1;s<e.length&&e.charCodeAt(s)===47;++s);for(var n=e.length,i=n-s,o=1;o<t.length&&t.charCodeAt(o)===47;++o);for(var a=t.length,u=a-o,g=i<u?i:u,m=-1,p=0;p<=g;++p){if(p===g){if(u>g){if(t.charCodeAt(o+p)===47)return t.slice(o+p+1);if(p===0)return t.slice(o+p)}else i>g&&(e.charCodeAt(s+p)===47?m=p:p===0&&(m=0));break}var v=e.charCodeAt(s+p),w=t.charCodeAt(o+p);if(v!==w)break;v===47&&(m=p)}var V="";for(p=s+m+1;p<=n;++p)(p===n||e.charCodeAt(p)===47)&&(V.length===0?V+="..":V+="/..");return V.length>0?V+t.slice(o+m):(o+=m,t.charCodeAt(o)===47&&++o,t.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(P(e),e.length===0)return".";for(var t=e.charCodeAt(0),s=t===47,n=-1,i=!0,o=e.length-1;o>=1;--o)if(t=e.charCodeAt(o),t===47){if(!i){n=o;break}}else i=!1;return n===-1?s?"/":".":s&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');P(e);var s=0,n=-1,i=!0,o;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,u=-1;for(o=e.length-1;o>=0;--o){var g=e.charCodeAt(o);if(g===47){if(!i){s=o+1;break}}else u===-1&&(i=!1,u=o+1),a>=0&&(g===t.charCodeAt(a)?--a===-1&&(n=o):(a=-1,n=u))}return s===n?n=u:n===-1&&(n=e.length),e.slice(s,n)}else{for(o=e.length-1;o>=0;--o)if(e.charCodeAt(o)===47){if(!i){s=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":e.slice(s,n)}},extname:function(e){P(e);for(var t=-1,s=0,n=-1,i=!0,o=0,a=e.length-1;a>=0;--a){var u=e.charCodeAt(a);if(u===47){if(!i){s=a+1;break}continue}n===-1&&(i=!1,n=a+1),u===46?t===-1?t=a:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||n===-1||o===0||o===1&&t===n-1&&t===s+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Vt("/",e)},parse:function(e){P(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var s=e.charCodeAt(0),n=s===47,i;n?(t.root="/",i=1):i=0;for(var o=-1,a=0,u=-1,g=!0,m=e.length-1,p=0;m>=i;--m){if(s=e.charCodeAt(m),s===47){if(!g){a=m+1;break}continue}u===-1&&(g=!1,u=m+1),s===46?o===-1?o=m:p!==1&&(p=1):o!==-1&&(p=-1)}return o===-1||u===-1||p===0||p===1&&o===u-1&&o===a+1?u!==-1&&(a===0&&n?t.base=t.name=e.slice(1,u):t.base=t.name=e.slice(a,u)):(a===0&&n?(t.name=e.slice(1,o),t.base=e.slice(1,u)):(t.name=e.slice(a,o),t.base=e.slice(a,u)),t.ext=e.slice(o,u)),a>0?t.dir=e.slice(0,a-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};O.posix=O;st.exports=O});var ot=E(it=>{function ee(){this.waiters=[]}ee.prototype.wait=function(r){var e=this,t={};this.waiters.push(t);var s=new Promise(function(n){var i=!1;t.resolve=function(o){if(!i){if(i=!0,t.timeout&&(clearTimeout(t.timeout),t.timeout=null),!o){var a=e.waiters.indexOf(t);a>-1&&e.waiters.splice(a,1)}n()}}});return r>0&&isFinite(r)&&(t.timeout=setTimeout(function(){t.timeout=null,t.resolve()},r)),s};ee.prototype.notify=function(){this.waiters.length>0&&this.waiters.pop().resolve(!0)};ee.prototype.notifyAll=function(){for(var r=this.waiters.length-1;r>=0;r--)this.waiters[r].resolve(!0);this.waiters=[]};it.Subject=ee});var ct=E(te=>{"use strict";te.byteLength=jt;te.toByteArray=Nt;te.fromByteArray=Wt;var x=[],k=[],Ut=typeof Uint8Array<"u"?Uint8Array:Array,oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(T=0,at=oe.length;T<at;++T)x[T]=oe[T],k[oe.charCodeAt(T)]=T;var T,at;k["-".charCodeAt(0)]=62;k["_".charCodeAt(0)]=63;function ut(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var s=t===e?0:4-t%4;return[t,s]}function jt(r){var e=ut(r),t=e[0],s=e[1];return(t+s)*3/4-s}function $t(r,e,t){return(e+t)*3/4-t}function Nt(r){var e,t=ut(r),s=t[0],n=t[1],i=new Ut($t(r,s,n)),o=0,a=n>0?s-4:s,u;for(u=0;u<a;u+=4)e=k[r.charCodeAt(u)]<<18|k[r.charCodeAt(u+1)]<<12|k[r.charCodeAt(u+2)]<<6|k[r.charCodeAt(u+3)],i[o++]=e>>16&255,i[o++]=e>>8&255,i[o++]=e&255;return n===2&&(e=k[r.charCodeAt(u)]<<2|k[r.charCodeAt(u+1)]>>4,i[o++]=e&255),n===1&&(e=k[r.charCodeAt(u)]<<10|k[r.charCodeAt(u+1)]<<4|k[r.charCodeAt(u+2)]>>2,i[o++]=e>>8&255,i[o++]=e&255),i}function zt(r){return x[r>>18&63]+x[r>>12&63]+x[r>>6&63]+x[r&63]}function Ht(r,e,t){for(var s,n=[],i=e;i<t;i+=3)s=(r[i]<<16&16711680)+(r[i+1]<<8&65280)+(r[i+2]&255),n.push(zt(s));return n.join("")}function Wt(r){for(var e,t=r.length,s=t%3,n=[],i=16383,o=0,a=t-s;o<a;o+=i)n.push(Ht(r,o,o+i>a?a:o+i));return s===1?(e=r[t-1],n.push(x[e>>2]+x[e<<4&63]+"==")):s===2&&(e=(r[t-2]<<8)+r[t-1],n.push(x[e>>10]+x[e>>4&63]+x[e<<2&63]+"=")),n.join("")}});var Zt={};Pt(Zt,{activate:()=>Jt,deactivate:()=>Qt});module.exports=xt(Zt);var ue=C(require("net")),M=C(require("vscode")),mt=require("crypto"),ft=require("os"),ae=require("path"),bt=require("process");var d=C(et()),lt=C(nt());var rt=require("events"),_=class{constructor(e,t){this.name=e;this._value=t}get value(){return this._value}set value(e){this._value=e,this._memory=void 0}get memory(){return this._memory===void 0&&typeof this._value=="string"&&(this._memory=new TextEncoder().encode(this._value)),this._memory}setMemory(e,t=0){let s=this.memory;!s||(s.set(e,t),this._memory=s,this._value=new TextDecoder().decode(s))}};function Y(r){return new Promise(e=>setTimeout(e,r))}var ie=class extends rt.EventEmitter{constructor(e){super();this.fileAccessor=e;this._sourceFile="";this.variables=new Map;this.sourceLines=[];this.instructions=[];this.starts=[];this.ends=[];this._currentLine=0;this.instruction=0;this.breakPoints=new Map;this.instructionBreakpoints=new Set;this.breakpointId=1;this.breakAddresses=new Map;this.otherExceptions=!1}get sourceFile(){return this._sourceFile}get currentLine(){return this._currentLine}set currentLine(e){this._currentLine=e,this.instruction=this.starts[e]}async start(e,t,s){await this.loadSource(this.normalizePathAndCasing(e)),s?(await this.verifyBreakpoints(this._sourceFile),t?this.findNextStatement(!1,"stopOnEntry"):this.continue(!1)):this.continue(!1)}continue(e){for(;!this.executeLine(this.currentLine,e)&&!(this.updateCurrentLine(e)||this.findNextStatement(e)););}step(e,t){e?(t?this.instruction--:this.instruction++,this.sendEvent("stopOnStep")):this.executeLine(this.currentLine,t)||this.updateCurrentLine(t)||this.findNextStatement(t,"stopOnStep")}updateCurrentLine(e){if(e)if(this.currentLine>0)this.currentLine--;else return this.currentLine=0,this.currentColumn=void 0,this.sendEvent("stopOnEntry"),!0;else if(this.currentLine<this.sourceLines.length-1)this.currentLine++;else return this.currentColumn=void 0,this.sendEvent("end"),!0;return!1}stepIn(e){typeof e=="number"?(this.currentColumn=e,this.sendEvent("stopOnStep")):(typeof this.currentColumn=="number"?this.currentColumn<=this.sourceLines[this.currentLine].length&&(this.currentColumn+=1):this.currentColumn=1,this.sendEvent("stopOnStep"))}stepOut(){typeof this.currentColumn=="number"&&(this.currentColumn-=1,this.currentColumn===0&&(this.currentColumn=void 0)),this.sendEvent("stopOnStep")}getStepInTargets(e){let t=this.getLine(),s=this.getWords(this.currentLine,t);if(e<0||e>=s.length)return[];let{name:n,index:i}=s[e];return n.split("").map((o,a)=>({id:i+a,label:`target: ${o}`}))}stack(e,t){let s=this.getLine(),n=this.getWords(this.currentLine,s);n.push({name:"BOTTOM",line:-1,index:-1});let i=s.indexOf("disassembly")>=0?this.instruction:void 0,o=typeof this.currentColumn=="number"?this.currentColumn:void 0,a=[];for(let u=e;u<Math.min(t,n.length);u++){let g={index:u,name:`${n[u].name}(${u})`,file:this._sourceFile,line:this.currentLine,column:o,instruction:i};a.push(g)}return{frames:a,count:n.length}}getBreakpoints(e,t){return this.getWords(t,this.getLine(t)).filter(s=>s.name.length>8).map(s=>s.index)}async setBreakPoint(e,t){e=this.normalizePathAndCasing(e);let s={verified:!1,line:t,id:this.breakpointId++},n=this.breakPoints.get(e);return n||(n=new Array,this.breakPoints.set(e,n)),n.push(s),await this.verifyBreakpoints(e),s}clearBreakPoint(e,t){let s=this.breakPoints.get(this.normalizePathAndCasing(e));if(s){let n=s.findIndex(i=>i.line===t);if(n>=0){let i=s[n];return s.splice(n,1),i}}}clearBreakpoints(e){this.breakPoints.delete(this.normalizePathAndCasing(e))}setDataBreakpoint(e,t){let s=t==="readWrite"?"read write":t,n=this.breakAddresses.get(e);return n?n!==s&&this.breakAddresses.set(e,"read write"):this.breakAddresses.set(e,s),!0}clearAllDataBreakpoints(){this.breakAddresses.clear()}setExceptionsFilters(e,t){this.namedException=e,this.otherExceptions=t}setInstructionBreakpoint(e){return this.instructionBreakpoints.add(e),!0}clearInstructionBreakpoints(){this.instructionBreakpoints.clear()}async getGlobalVariables(e){let t=[];for(let s=0;s<10&&(t.push(new _(`global_${s}`,s)),!(e&&e()));s++)await Y(1e3);return t}getLocalVariables(){return Array.from(this.variables,([e,t])=>t)}getLocalVariable(e){return this.variables.get(e)}disassemble(e,t){let s=[];for(let n=e;n<e+t;n++)n>=0&&n<this.instructions.length?s.push({address:n,instruction:this.instructions[n].name,line:this.instructions[n].line}):s.push({address:n,instruction:"nop"});return s}getLine(e){return this.sourceLines[e===void 0?this.currentLine:e].trim()}getWords(e,t){let s=/[a-z]+/ig,n=[],i;for(;i=s.exec(t);)n.push({name:i[0],line:e,index:i.index});return n}async loadSource(e){this._sourceFile!==e&&(this._sourceFile=this.normalizePathAndCasing(e),this.initializeContents(await this.fileAccessor.readFile(e)))}initializeContents(e){this.sourceLines=new TextDecoder().decode(e).split(/\r?\n/),this.instructions=[],this.starts=[],this.instructions=[],this.ends=[];for(let t=0;t<this.sourceLines.length;t++){this.starts.push(this.instructions.length);let s=this.getWords(t,this.sourceLines[t]);for(let n of s)this.instructions.push(n);this.ends.push(this.instructions.length)}}findNextStatement(e,t){for(let s=this.currentLine;e?s>=0:s<this.sourceLines.length;e?s--:s++){let n=this.breakPoints.get(this._sourceFile);if(n){let o=n.filter(a=>a.line===s);if(o.length>0)return this.sendEvent("stopOnBreakpoint"),o[0].verified||(o[0].verified=!0,this.sendEvent("breakpointValidated",o[0])),this.currentLine=s,!0}if(this.getLine(s).length>0){this.currentLine=s;break}}return t?(this.sendEvent(t),!0):!1}executeLine(e,t){for(;t?this.instruction>=this.starts[e]:this.instruction<this.ends[e];)if(t?this.instruction--:this.instruction++,this.instructionBreakpoints.has(this.instruction))return this.sendEvent("stopOnInstructionBreakpoint"),!0;let s=this.getLine(e),n=/\$([a-z][a-z0-9]*)(=(false|true|[0-9]+(\.[0-9]+)?|\".*\"|\{.*\}))?/ig,i;for(;i=n.exec(s);)if(i.length===5){let g,m=i[1],p=i[3],v=new _(m,p);p&&p.length>0?(p==="true"?v.value=!0:p==="false"?v.value=!1:p[0]==='"'?v.value=p.slice(1,-1):p[0]==="{"?v.value=[new _("fBool",!0),new _("fInteger",123),new _("fString","hello"),new _("flazyInteger",321)]:v.value=parseFloat(p),this.variables.has(m)&&(g="write"),this.variables.set(m,v)):this.variables.has(m)&&(g="read");let w=this.breakAddresses.get(m);if(g&&w&&w.indexOf(g)>=0)return this.sendEvent("stopOnDataBreakpoint",g),!0}let o=/(log|prio|out|err)\(([^\)]*)\)/g,a;for(;a=o.exec(s);)a.length===3&&this.sendEvent("output",a[1],a[2],this._sourceFile,e,a.index);let u=/exception\((.*)\)/.exec(s);if(u&&u.length===2){let g=u[1].trim();if(this.namedException===g)return this.sendEvent("stopOnException",g),!0;if(this.otherExceptions)return this.sendEvent("stopOnException",void 0),!0}else if(s.indexOf("exception")>=0&&this.otherExceptions)return this.sendEvent("stopOnException",void 0),!0;return!1}async verifyBreakpoints(e){let t=this.breakPoints.get(e);t&&(await this.loadSource(e),t.forEach(s=>{if(!s.verified&&s.line<this.sourceLines.length){let n=this.getLine(s.line);(n.length===0||n.indexOf("+")===0)&&s.line++,n.indexOf("-")===0&&s.line--,n.indexOf("lazy")<0&&(s.verified=!0,this.sendEvent("breakpointValidated",s))}}))}sendEvent(e,...t){setTimeout(()=>{this.emit(e,...t)},0)}normalizePathAndCasing(e){return this.fileAccessor.isWindows?e.replace(/\//g,"\\").toLowerCase():e.replace(/\\/g,"/")}};var dt=C(ot()),se=C(ct()),D=class extends d.LoggingDebugSession{constructor(e){super("mock-debug.txt");this._variableHandles=new d.Handles;this._configurationDone=new dt.Subject;this._cancellationTokens=new Map;this._reportProgress=!1;this._progressId=1e4;this._cancelledProgressId=void 0;this._isProgressCancellable=!0;this._valuesInHex=!1;this._useInvalidatedEvent=!1;this._addressesInHex=!0;this.setDebuggerLinesStartAt1(!1),this.setDebuggerColumnsStartAt1(!1),this._runtime=new ie(e),this._runtime.on("stopOnEntry",()=>{this.sendEvent(new d.StoppedEvent("entry",D.threadID))}),this._runtime.on("stopOnStep",()=>{this.sendEvent(new d.StoppedEvent("step",D.threadID))}),this._runtime.on("stopOnBreakpoint",()=>{this.sendEvent(new d.StoppedEvent("breakpoint",D.threadID))}),this._runtime.on("stopOnDataBreakpoint",()=>{this.sendEvent(new d.StoppedEvent("data breakpoint",D.threadID))}),this._runtime.on("stopOnInstructionBreakpoint",()=>{this.sendEvent(new d.StoppedEvent("instruction breakpoint",D.threadID))}),this._runtime.on("stopOnException",t=>{t?this.sendEvent(new d.StoppedEvent(`exception(${t})`,D.threadID)):this.sendEvent(new d.StoppedEvent("exception",D.threadID))}),this._runtime.on("breakpointValidated",t=>{this.sendEvent(new d.BreakpointEvent("changed",{verified:t.verified,id:t.id}))}),this._runtime.on("output",(t,s,n,i,o)=>{let a;switch(t){case"prio":a="important";break;case"out":a="stdout";break;case"err":a="stderr";break;default:a="console";break}let u=new d.OutputEvent(`${s}
`,a);(s==="start"||s==="startCollapsed"||s==="end")&&(u.body.group=s,u.body.output=`group-${s}
`),u.body.source=this.createSource(n),u.body.line=this.convertDebuggerLineToClient(i),u.body.column=this.convertDebuggerColumnToClient(o),this.sendEvent(u)}),this._runtime.on("end",()=>{this.sendEvent(new d.TerminatedEvent)})}initializeRequest(e,t){t.supportsProgressReporting&&(this._reportProgress=!0),t.supportsInvalidatedEvent&&(this._useInvalidatedEvent=!0),e.body=e.body||{},e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!0,e.body.supportsStepBack=!0,e.body.supportsDataBreakpoints=!0,e.body.supportsCompletionsRequest=!0,e.body.completionTriggerCharacters=[".","["],e.body.supportsCancelRequest=!0,e.body.supportsBreakpointLocationsRequest=!0,e.body.supportsStepInTargetsRequest=!0,e.body.supportsExceptionFilterOptions=!0,e.body.exceptionBreakpointFilters=[{filter:"namedException",label:"Named Exception",description:"Break on named exceptions. Enter the exception's name as the Condition.",default:!1,supportsCondition:!0,conditionDescription:"Enter the exception's name"},{filter:"otherExceptions",label:"Other Exceptions",description:"This is a other exception",default:!0,supportsCondition:!1}],e.body.supportsExceptionInfoRequest=!0,e.body.supportsSetVariable=!0,e.body.supportsSetExpression=!0,e.body.supportsDisassembleRequest=!0,e.body.supportsSteppingGranularity=!0,e.body.supportsInstructionBreakpoints=!0,e.body.supportsReadMemoryRequest=!0,e.body.supportsWriteMemoryRequest=!0,e.body.supportSuspendDebuggee=!0,e.body.supportTerminateDebuggee=!0,e.body.supportsFunctionBreakpoints=!0,e.body.supportsDelayedStackTraceLoading=!0,this.sendResponse(e),this.sendEvent(new d.InitializedEvent)}configurationDoneRequest(e,t){super.configurationDoneRequest(e,t),this._configurationDone.notify()}disconnectRequest(e,t,s){console.log(`disconnectRequest suspend: ${t.suspendDebuggee}, terminate: ${t.terminateDebuggee}`)}async attachRequest(e,t){return this.launchRequest(e,t)}async launchRequest(e,t){d.logger.setup(t.trace?d.Logger.LogLevel.Verbose:d.Logger.LogLevel.Stop,!1),await this._configurationDone.wait(1e3),await this._runtime.start(t.program,!!t.stopOnEntry,!t.noDebug),t.compileError?this.sendErrorResponse(e,{id:1001,format:"compile error: some fake error.",showUser:t.compileError==="show"?!0:t.compileError==="hide"?!1:void 0}):this.sendResponse(e)}setFunctionBreakPointsRequest(e,t,s){this.sendResponse(e)}async setBreakPointsRequest(e,t){let s=t.source.path,n=t.lines||[];this._runtime.clearBreakpoints(s);let i=n.map(async a=>{let{verified:u,line:g,id:m}=await this._runtime.setBreakPoint(s,this.convertClientLineToDebugger(a)),p=new d.Breakpoint(u,this.convertDebuggerLineToClient(g));return p.id=m,p}),o=await Promise.all(i);e.body={breakpoints:o},this.sendResponse(e)}breakpointLocationsRequest(e,t,s){if(t.source.path){let n=this._runtime.getBreakpoints(t.source.path,this.convertClientLineToDebugger(t.line));e.body={breakpoints:n.map(i=>({line:t.line,column:this.convertDebuggerColumnToClient(i)}))}}else e.body={breakpoints:[]};this.sendResponse(e)}async setExceptionBreakPointsRequest(e,t){let s,n=!1;if(t.filterOptions)for(let i of t.filterOptions)switch(i.filterId){case"namedException":s=t.filterOptions[0].condition;break;case"otherExceptions":n=!0;break}t.filters&&t.filters.indexOf("otherExceptions")>=0&&(n=!0),this._runtime.setExceptionsFilters(s,n),this.sendResponse(e)}exceptionInfoRequest(e,t){e.body={exceptionId:"Exception ID",description:"This is a descriptive description of the exception.",breakMode:"always",details:{message:"Message contained in the exception.",typeName:"Short type name of the exception object",stackTrace:`stack frame 1
stack frame 2`}},this.sendResponse(e)}threadsRequest(e){e.body={threads:[new d.Thread(D.threadID,"thread 1"),new d.Thread(D.threadID+1,"thread 2")]},this.sendResponse(e)}stackTraceRequest(e,t){let s=typeof t.startFrame=="number"?t.startFrame:0,n=typeof t.levels=="number"?t.levels:1e3,i=s+n,o=this._runtime.stack(s,i);e.body={stackFrames:o.frames.map((a,u)=>{let g=new d.StackFrame(a.index,a.name,this.createSource(a.file),this.convertDebuggerLineToClient(a.line));if(typeof a.column=="number"&&(g.column=this.convertDebuggerColumnToClient(a.column)),typeof a.instruction=="number"){let m=this.formatAddress(a.instruction);g.name=`${a.name} ${m}`,g.instructionPointerReference=m}return g}),totalFrames:o.count},this.sendResponse(e)}scopesRequest(e,t){e.body={scopes:[new d.Scope("Locals",this._variableHandles.create("locals"),!1),new d.Scope("Globals",this._variableHandles.create("globals"),!0)]},this.sendResponse(e)}async writeMemoryRequest(e,{data:t,memoryReference:s,offset:n=0}){let i=this._variableHandles.get(Number(s));if(typeof i=="object"){let o=se.toByteArray(t);i.setMemory(o,n),e.body={bytesWritten:o.length}}else e.body={bytesWritten:0};this.sendResponse(e),this.sendEvent(new d.InvalidatedEvent(["variables"]))}async readMemoryRequest(e,{offset:t=0,count:s,memoryReference:n}){let i=this._variableHandles.get(Number(n));if(typeof i=="object"&&i.memory){let o=i.memory.subarray(Math.min(t,i.memory.length),Math.min(t+s,i.memory.length));e.body={address:t.toString(),data:se.fromByteArray(o),unreadableBytes:s-o.length}}else e.body={address:t.toString(),data:"",unreadableBytes:s};this.sendResponse(e)}async variablesRequest(e,t,s){let n=[],i=this._variableHandles.get(t.variablesReference);i==="locals"?n=this._runtime.getLocalVariables():i==="globals"?s?(this._cancellationTokens.set(s.seq,!1),n=await this._runtime.getGlobalVariables(()=>!!this._cancellationTokens.get(s.seq)),this._cancellationTokens.delete(s.seq)):n=await this._runtime.getGlobalVariables():i&&Array.isArray(i.value)&&(n=i.value),e.body={variables:n.map(o=>this.convertFromRuntime(o))},this.sendResponse(e)}setVariableRequest(e,t){let s=this._variableHandles.get(t.variablesReference),n=s==="locals"?this._runtime.getLocalVariable(t.name):s instanceof _&&s.value instanceof Array?s.value.find(i=>i.name===t.name):void 0;n&&(n.value=this.convertToRuntime(t.value),e.body=this.convertFromRuntime(n),n.memory&&n.reference&&this.sendEvent(new d.MemoryEvent(String(n.reference),0,n.memory.length))),this.sendResponse(e)}continueRequest(e,t){this._runtime.continue(!1),this.sendResponse(e)}reverseContinueRequest(e,t){this._runtime.continue(!0),this.sendResponse(e)}nextRequest(e,t){this._runtime.step(t.granularity==="instruction",!1),this.sendResponse(e)}stepBackRequest(e,t){this._runtime.step(t.granularity==="instruction",!0),this.sendResponse(e)}stepInTargetsRequest(e,t){let s=this._runtime.getStepInTargets(t.frameId);e.body={targets:s.map(n=>({id:n.id,label:n.label}))},this.sendResponse(e)}stepInRequest(e,t){this._runtime.stepIn(t.targetId),this.sendResponse(e)}stepOutRequest(e,t){this._runtime.stepOut(),this.sendResponse(e)}async evaluateRequest(e,t){let s,n;switch(t.context){case"repl":let i=/new +([0-9]+)/.exec(t.expression);if(i&&i.length===2){let o=await this._runtime.setBreakPoint(this._runtime.sourceFile,this.convertClientLineToDebugger(parseInt(i[1]))),a=new d.Breakpoint(o.verified,this.convertDebuggerLineToClient(o.line),void 0,this.createSource(this._runtime.sourceFile));a.id=o.id,this.sendEvent(new d.BreakpointEvent("new",a)),s="breakpoint created"}else{let o=/del +([0-9]+)/.exec(t.expression);if(o&&o.length===2){let a=this._runtime.clearBreakPoint(this._runtime.sourceFile,this.convertClientLineToDebugger(parseInt(o[1])));if(a){let u=new d.Breakpoint(!1);u.id=a.id,this.sendEvent(new d.BreakpointEvent("removed",u)),s="breakpoint deleted"}}else{let a=/progress/.exec(t.expression);a&&a.length===1&&(this._reportProgress?(s="progress started",this.progressSequence()):s="frontend doesn't support progress (capability 'supportsProgressReporting' not set)")}}default:t.expression.startsWith("$")?n=this._runtime.getLocalVariable(t.expression.substr(1)):n=new _("eval",this.convertToRuntime(t.expression));break}if(n){let i=this.convertFromRuntime(n);e.body={result:i.value,type:i.type,variablesReference:i.variablesReference,presentationHint:i.presentationHint}}else e.body={result:s||`evaluate(context: '${t.context}', '${t.expression}')`,variablesReference:0};this.sendResponse(e)}setExpressionRequest(e,t){if(t.expression.startsWith("$")){let s=this._runtime.getLocalVariable(t.expression.substr(1));s?(s.value=this.convertToRuntime(t.value),e.body=this.convertFromRuntime(s),this.sendResponse(e)):this.sendErrorResponse(e,{id:1002,format:"variable '{lexpr}' not found",variables:{lexpr:t.expression},showUser:!0})}else this.sendErrorResponse(e,{id:1003,format:"'{lexpr}' not an assignable expression",variables:{lexpr:t.expression},showUser:!0})}async progressSequence(){let e=""+this._progressId++;await Y(100);let t=this._isProgressCancellable?"Cancellable operation":"Long running operation",s=new d.ProgressStartEvent(e,t);s.body.cancellable=this._isProgressCancellable,this._isProgressCancellable=!this._isProgressCancellable,this.sendEvent(s),this.sendEvent(new d.OutputEvent(`start progress: ${e}
`));let n="progress ended";for(let i=0;i<100;i++)if(await Y(500),this.sendEvent(new d.ProgressUpdateEvent(e,`progress: ${i}`)),this._cancelledProgressId===e){n="progress cancelled",this._cancelledProgressId=void 0,this.sendEvent(new d.OutputEvent(`cancel progress: ${e}
`));break}this.sendEvent(new d.ProgressEndEvent(e,n)),this.sendEvent(new d.OutputEvent(`end progress: ${e}
`)),this._cancelledProgressId=void 0}dataBreakpointInfoRequest(e,t){e.body={dataId:null,description:"cannot break on data access",accessTypes:void 0,canPersist:!1},t.variablesReference&&t.name&&(this._variableHandles.get(t.variablesReference)==="globals"?(e.body.dataId=t.name,e.body.description=t.name,e.body.accessTypes=["write"],e.body.canPersist=!0):(e.body.dataId=t.name,e.body.description=t.name,e.body.accessTypes=["read","write","readWrite"],e.body.canPersist=!0)),this.sendResponse(e)}setDataBreakpointsRequest(e,t){this._runtime.clearAllDataBreakpoints(),e.body={breakpoints:[]};for(let s of t.breakpoints){let n=this._runtime.setDataBreakpoint(s.dataId,s.accessType||"write");e.body.breakpoints.push({verified:n})}this.sendResponse(e)}completionsRequest(e,t){e.body={targets:[{label:"item 10",sortText:"10"},{label:"item 1",sortText:"01",detail:"detail 1"},{label:"item 2",sortText:"02",detail:"detail 2"},{label:"array[]",selectionStart:6,sortText:"03"},{label:"func(arg)",selectionStart:5,selectionLength:3,sortText:"04"}]},this.sendResponse(e)}cancelRequest(e,t){t.requestId&&this._cancellationTokens.set(t.requestId,!0),t.progressId&&(this._cancelledProgressId=t.progressId)}disassembleRequest(e,t){let s=parseInt(t.memoryReference),n=t.instructionOffset||0,i=t.instructionCount,o=t.memoryReference.startsWith("0x"),a=o?t.memoryReference.length-2:t.memoryReference.length,u=this.createSource(this._runtime.sourceFile),g=-1,m=this._runtime.disassemble(s+n,i).map(p=>{let v=p.address.toString(o?16:10).padStart(a,"0"),w={address:o?`0x${v}`:`${v}`,instruction:p.instruction};return p.line!==void 0&&g!==p.line&&(g=p.line,w.location=u,w.line=this.convertDebuggerLineToClient(p.line)),w});e.body={instructions:m},this.sendResponse(e)}setInstructionBreakpointsRequest(e,t){this._runtime.clearInstructionBreakpoints();let s=t.breakpoints.map(n=>{let i=parseInt(n.instructionReference),o=n.offset||0;return{verified:this._runtime.setInstructionBreakpoint(i+o)}});e.body={breakpoints:s},this.sendResponse(e)}customRequest(e,t,s){e==="toggleFormatting"?(this._valuesInHex=!this._valuesInHex,this._useInvalidatedEvent&&this.sendEvent(new d.InvalidatedEvent(["variables"])),this.sendResponse(t)):super.customRequest(e,t,s)}convertToRuntime(e){if(e=e.trim(),e==="true")return!0;if(e==="false")return!1;if(e[0]==="'"||e[0]==='"')return e.substr(1,e.length-2);let t=parseFloat(e);return isNaN(t)?e:t}convertFromRuntime(e){let t={name:e.name,value:"???",type:typeof e.value,variablesReference:0,evaluateName:"$"+e.name};if(e.name.indexOf("lazy")>=0)t.value="lazy var",e.reference??(e.reference=this._variableHandles.create(new _("",[new _("",e.value)]))),t.variablesReference=e.reference,t.presentationHint={lazy:!0};else if(Array.isArray(e.value))t.value="Object",e.reference??(e.reference=this._variableHandles.create(e)),t.variablesReference=e.reference;else switch(typeof e.value){case"number":Math.round(e.value)===e.value?(t.value=this.formatNumber(e.value),t.__vscodeVariableMenuContext="simple",t.type="integer"):(t.value=e.value.toString(),t.type="float");break;case"string":t.value=`"${e.value}"`;break;case"boolean":t.value=e.value?"true":"false";break;default:t.value=typeof e.value;break}return e.memory&&(e.reference??(e.reference=this._variableHandles.create(e)),t.memoryReference=String(e.reference)),t}formatAddress(e,t=8){return this._addressesInHex?"0x"+e.toString(16).padStart(8,"0"):e.toString(10)}formatNumber(e){return this._valuesInHex?"0x"+e.toString(16):e.toString(10)}createSource(e){return new d.Source((0,lt.basename)(e),this.convertDebuggerPathToClient(e),void 0,void 0,"mock-adapter-data")}},F=D;F.threadID=1;var h=C(require("vscode"));function j(r,e){r.subscriptions.push(h.commands.registerCommand("extension.mock-debug.runEditorContents",s=>{let n=s;!n&&h.window.activeTextEditor&&(n=h.window.activeTextEditor.document.uri),n&&h.debug.startDebugging(void 0,{type:"mock",name:"Run File",request:"launch",program:n.fsPath},{noDebug:!0})}),h.commands.registerCommand("extension.mock-debug.debugEditorContents",s=>{let n=s;!n&&h.window.activeTextEditor&&(n=h.window.activeTextEditor.document.uri),n&&h.debug.startDebugging(void 0,{type:"mock",name:"Debug File",request:"launch",program:n.fsPath,stopOnEntry:!0})}),h.commands.registerCommand("extension.mock-debug.toggleFormatting",s=>{let n=h.debug.activeDebugSession;n&&n.customRequest("toggleFormatting")})),r.subscriptions.push(h.commands.registerCommand("extension.mock-debug.getProgramName",s=>h.window.showInputBox({placeHolder:"Please enter the name of a markdown file in the workspace folder",value:"readme.md"})));let t=new ht;r.subscriptions.push(h.debug.registerDebugConfigurationProvider("mock",t)),r.subscriptions.push(h.debug.registerDebugConfigurationProvider("mock",{provideDebugConfigurations(s){return[{name:"Dynamic Launch",request:"launch",type:"mock",program:"${file}"},{name:"Another Dynamic Launch",request:"launch",type:"mock",program:"${file}"},{name:"Mock Launch",request:"launch",type:"mock",program:"${file}"}]}},h.DebugConfigurationProviderTriggerKind.Dynamic)),e||(e=new gt),r.subscriptions.push(h.debug.registerDebugAdapterDescriptorFactory("mock",e)),"dispose"in e&&r.subscriptions.push(e),r.subscriptions.push(h.languages.registerEvaluatableExpressionProvider("markdown",{provideEvaluatableExpression(s,n){let i=/\$[a-z][a-z0-9]*/ig,o=s.lineAt(n.line).text,a;for(;a=i.exec(o);){let u=new h.Range(n.line,a.index,n.line,a.index+a[0].length);if(u.contains(n))return new h.EvaluatableExpression(u)}}})),r.subscriptions.push(h.languages.registerInlineValuesProvider("markdown",{provideInlineValues(s,n,i){let o=[];for(let g=n.start.line;g<=i.stoppedLocation.end.line;g++){let m=s.lineAt(g);var a=/\$([a-z][a-z0-9]*)/ig;do{var u=a.exec(m.text);if(u){let p=u[1],v=new h.Range(g,u.index,g,u.index+p.length);o.push(new h.InlineValueVariableLookup(v,p,!1))}}while(u)}return o}}))}var ht=class{resolveDebugConfiguration(e,t,s){if(!t.type&&!t.request&&!t.name){let n=h.window.activeTextEditor;n&&n.document.languageId==="markdown"&&(t.type="mock",t.name="Launch",t.request="launch",t.program="${file}",t.stopOnEntry=!0)}return t.program?t:h.window.showInformationMessage("Cannot find a program to debug").then(n=>{})}},ne={isWindows:!1,async readFile(r){let e;try{e=pt(r)}catch{return new TextEncoder().encode(`cannot read '${r}'`)}return await h.workspace.fs.readFile(e)},async writeFile(r,e){await h.workspace.fs.writeFile(pt(r),e)}};function pt(r){try{return h.Uri.file(r)}catch{return h.Uri.parse(r)}}var gt=class{createDebugAdapterDescriptor(e){return new h.DebugAdapterInlineImplementation(new F(ne))}};var Gt="inline";function Jt(r){switch(Gt){case"server":j(r,new Rt);break;case"namedPipeServer":j(r,new yt);break;case"external":default:j(r,new vt);break;case"inline":j(r);break}}function Qt(){}var vt=class{createDebugAdapterDescriptor(e,t){if(!t){let s="absolute path to my DA executable",n=["some args","another arg"],i={cwd:"working directory for executable",env:{envVariable:"some value"}};t=new M.DebugAdapterExecutable(s,n,i)}return t}},Rt=class{createDebugAdapterDescriptor(e,t){return this.server||(this.server=ue.createServer(s=>{let n=new F(ne);n.setRunAsServer(!0),n.start(s,s)}).listen(0)),new M.DebugAdapterServer(this.server.address().port)}dispose(){this.server&&this.server.close()}},yt=class{createDebugAdapterDescriptor(e,t){if(!this.server){let s=(0,mt.randomBytes)(10).toString("utf8"),n=bt.platform==="win32"?(0,ae.join)("\\\\.\\pipe\\",s):(0,ae.join)((0,ft.tmpdir)(),s);this.server=ue.createServer(i=>{let o=new F(ne);o.setRunAsServer(!0),o.start(i,i)}).listen(n)}return new M.DebugAdapterNamedPipeServer(this.server.address())}dispose(){this.server&&this.server.close()}};"use strict";0&&(module.exports={activate,deactivate});
